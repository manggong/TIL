# MSA

### API Gateway의 필요성

- 클라이언트가 서비스에 직접 접근하면 생기는 문제점
  - 각각의 서비스마다 인증/인가 등 공통된 로직을 구현해야 함
  - 수많은 API 호출을 기록하고 관리하기 어려움
  - 클라이언트에서 여러 마이크로서비스에 대한 번거로운 호출을 해야함
  - 내부의 비즈니스 로직이 드러나게 되어 보안에 취약

### API Gateway의 주요기능

1. 인증 및 인가(Authentication and Authorization)

- 마이크로서비스 아키텍처에서의 각각의 서비스에 API호출에 대한 인증 및 인가를 하는 것은 같은 소스코드를 중복 사용할 뿐만 아니라 관리하기도 어렵다. 그래서 인증서 고나리, 인증, SSL, 프로토콜 변환과 같은 기능은 API Gateway에서 오프로드 한다.

2. 요청 절차의 단순화

- 클라이언트는 사용하려는 서비스의 각각의 API가 아닌 API Gateway에만 요청하면 된다.

3. 라우팅 및 로드밸런싱

- 클라이언트의 요청에 따라서 API 호출을 적절한 서비스에 라우팅 한다. => 서비스 인스턴스들에 대한 부하분산 가능

4. 서비스 오케스트레이션

- 여러개의 서비스를 묶어서 하나로 만들 수 있음 => API Gateway에 부하가 생김

5. 서비스 디스커버리

- API Gateway는 각 서비스를 호출하기위해, 서비스마다의 IP주소와 포트번호를 알고 있어야 한다. legacy 환경에서는 고정적인 IP주소를 가지고 있기 때문에 크게 문제될 것이 없지만 클라우드 환경에서는 동적인 환경에서 배포되기 때문에 서비스의 위치를 찾는 것이 어렵다. 이러한 서비스 위치를 찾는 것을 Service Discovery라 하며, API Gateway에서 서버사이드나, 클라이언트 사이드를 기준으로 하여 서비스 디스커버리를 구현할 수 있다.

### API Gateway 적용시 고려해야 할 사항

1. API Gateway 적용의 가장 큰 단점은 API Gateway를 내부 마이크로서비스와 결합한다는 것이다. 이러한 결합은 기존 SOA에서의 ESB(Enterprise Service Bus)에서 발생했던 문제점이 다시 발생할 수 있다.

```
2000년대 후반, 많은 SOA 프로젝트가 실패한 이유로 SOA의 핵심적인 요소 중 하나인 ESB가 꼽히는 경우를 많이 볼 수 있었습니다. 그 이유는 다음과 같다.
첫 번째로, 당시 ESB 내부 처리 로직을 XML을 기반으로 하였는데, XML의 파싱은 오버헤드가 큰 작업이었다.
두 번째로, ESB는 가벼운 연산 뿐만 아니라, 과도한 Orchestration 등 무거운 로직을 가지고 있었습니다. 특히 ESB를 Gateway로의 특성이 아닌 시스템을 통합하기 위한 역할로 많이 구현하였기 때문에 많은 실패 사례가 발생했다.
```

- API Gateway의 Scale-out 적용이 유연하게 일어나지 않을 경우, API Gateway가 병목지점이 되어 어플리케이션의 성능저하가 일어날 수 있다.
- API Gateway라는 추가적인 계층이 만들어지는 것이기 때문에, 그 만큼 네트워크 latency가 증가하게 된다.
