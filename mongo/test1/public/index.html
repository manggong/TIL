<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Document</title>
  <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-cookie/1.4.1/jquery.cookie.min.js"></script>
  <script>
    function deleteMember(_id) {
      $.post('./member/delete', {
        _id
      }, function (returnData) {})
    }

    function display(_id, name, age, married) {
      $.cookie('_id', _id)
      $('#name').val(name);
      $('#age').val(age);
      if (married !== 'false') {
        $("input[name='married']").prop("checked", true);
      } else {
        $("input[name='married']").prop("checked", false);
      }
    }

    $(document).ready(function () {

      $("#updateMember").click(function () {
        const _id = $.cookie('_id');
        const name = $("#name").val();
        const age = $("#age").val();
        const married = $("input[name='married']").is(":checked");
        const send_param = {
          _id,
          name,
          age,
          married
        };
        $.post("/member/update", send_param, function (returnData) {
          alert(returnData.message);
        });

      });


      $("#addMember").click(function () {
        const name = $("#name").val();
        const age = $("#age").val();
        const married = $("input[name='married']").is(":checked");
        const send_param = {
          name,
          age,
          married
        };
        $.post("/member/add", send_param, function (returnData) {
          alert(returnData.message);
        });
      });

      $("#getAllMember").click(function () {
        $.post("/member/getAllMember", {}, function (returnData) {
          let result = `<table border="1"><tr><td>아이디</td><td>이름</td><td>나이</td><td>결혼</td>
            <td>삭제여부</td></tr>`;
          returnData.message.forEach(element => {
            result +=
              `<tr><td onclick="display('${element._id}','${element.name}','${element.age}','${element.married}')">${element._id}</td><td>${element.name}</td>
                <td>${element.age}</td><td>${element.married}</td><td><button onclick="deleteMember('${element._id}')">삭제</button></td></tr>`;
          });
          result += `</table>`;
          $("#all_div").html(result);
        });
      });
    });
  </script>
</head>

<body>
  <input id="name" placeholder="이름" /><br />
  <input id="age" placeholder="나이" /><br />
  <input type="checkbox" name="married" />결혼 여부 <br />
  <button id="addMember">등록</button>
  <button id="updateMember">수정</button><br /><br />

  <button id="getAllMember">모든 멤버 보기</button>
  <button>댓글 달기</button>
  <button>댓글 수정</button>

  <div id="all_div"></div>
</body>

</html>